CreatePurchase:
  handler: src/purchase/handler/create-purchase.handler
  name: ${self:service}-${self:provider.stage}-create-purchase-function
  events:
    - http:
        path: /purchase/{dni}
        method: post
        cors: true
        request:
          parameters:
            dni:
              id: true
  environment:
    PURCHASE_TABLE: ${self:custom.environment.PURCHASES_TABLE_NAME}
    AMOUNT_REACHED_TOPIC: !Ref AmountReachedTopic
    GET_CLIENT_BY_ID_LAMBDA_NAME: ${self:custom.environment.GET_CLIENT_BY_ID_LAMBDA_NAME}
  iamRoleStatementsInherit: true
  iamRoleStatements:
    - Effect: Allow
      Action:
        - sns:Publish
      Resource:
        - !Ref AmountReachedTopic
    - Effect: Allow
      Action:
        - dynamodb:PutItem
      Resource:
        - !GetAtt PurchasesTable.Arn
    - Effect: Allow
      Action:
        - lambda:InvokeFunction
      Resource:
        - ${self:custom.environment.GET_CLIENT_BY_ID_LAMBDA_ARN}
